// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Gallery {
  id              Int                   @id @default(autoincrement())
  uid             String                @unique @default(cuid())
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  name            String
  slug            String                @unique
  address         PostalAddress?        @relation(fields: [postalAddressId], references: [id])
  openingHours    OpeningHours?         @relation(fields: [openingHoursId], references: [id])
  nearestTubes    GalleryTubeStations[]
  location        Location?             @relation(fields: [locationId], references: [id])
  postalAddressId Int?
  website         String?

  openingHoursId Int?
  locationId     Int?
}

model TubeStation {
  id        Int                   @id @default(autoincrement())
  uid       String                @unique @default(cuid())
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt
  name      String                @unique
  slug      String                @unique
  galleries GalleryTubeStations[]
}

model GalleryTubeStations {
  gallery       Gallery     @relation(fields: [galleryId], references: [id])
  galleryId     Int
  tubeStation   TubeStation @relation(fields: [tubeStationId], references: [id])
  tubeStationId Int
  assignedAt    DateTime    @default(now())
  assignedBy    String?

  @@id([galleryId, tubeStationId])
}

model Location {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  latitude  Float
  longitude Float
  Gallery   Gallery[]
}

model PostalAddress {
  id            Int       @id @default(autoincrement())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  streetAddress String
  locality      String
  city          String
  postalCode    String
  country       String
  Gallery       Gallery[]
}

model OpeningHours {
  id                 Int                 @id @default(autoincrement())
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  openingHoursRanges OpeningHoursRange[]
  Gallery            Gallery[]
}

model OpeningHoursRange {
  id             Int          @id @default(autoincrement())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  startDay       Int
  endDay         Int
  openingTime    String
  closingTime    String
  OpeningHours   OpeningHours @relation(fields: [openingHoursId], references: [id])
  openingHoursId Int
}

model User {
  id          Int          @id @default(autoincrement())
  uid         String       @unique @default(cuid())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  username    String       @unique
  email       String       @unique
  duoUserId   String?
  fidoU2fKeys FidoU2FKey[]
  password    String
}

model FidoU2FKey {
  id        Int      @id @default(autoincrement())
  uid       String   @unique @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  publicKey String
  keyHandle String
  label     String
  User      User?    @relation(fields: [userId], references: [id])
  userId    Int?
}
